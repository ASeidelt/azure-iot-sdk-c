<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Azure IoT C SDK: Run a simple C sample on Freescale FRDM-K64F device running mbed</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="style.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Azure IoT C SDK
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.0 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Run a simple C sample on Freescale FRDM-K64F device running mbed </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1><a class="anchor" id="autotoc_md124"></a>
Table of Contents</h1>
<ul>
<li><a href="#Introduction">Introduction</a></li>
<li><a href="#Step-1-Prerequisites">Step 1: Prerequisites</a></li>
<li><a href="#Step-2-PrepareDevice">Step 2: Prepare your Device</a></li>
<li><a href="#Step-3-Build">Step 3: Build and Run the Sample</a></li>
<li><a href="#tips">Tips</a></li>
</ul>
<p><a class="anchor" id="Introduction"></a> </p>
<h1><a class="anchor" id="autotoc_md125"></a>
Introduction</h1>
<p><b>About this document</b></p>
<p>This document describes the steps for connecting an <a href="https://developer.mbed.org/platforms/FRDM-K64F/">mbed-enabled Freescale FRDM-K64F</a> device to Azure IoT Hub. This multi-step process includes:</p><ul>
<li>Configuring Azure IoT Hub</li>
<li>Registering your IoT device</li>
<li>Build and deploy Azure IoT SDK on device</li>
</ul>
<p><a class="anchor" id="Step-1-Prerequisites"></a> </p>
<h1><a class="anchor" id="autotoc_md126"></a>
Step 1: Prerequisites</h1>
<p>You should have the following items ready before beginning the process:</p><ul>
<li>Computer with Git client installed and access to the <a href="https://github.com/Azure/azure-iot-sdk-c">azure-iot-sdk-c</a> GitHub public repository.</li>
<li>SSH client on your desktop computer, such as <a href="http://www.putty.org/">PuTTY</a>, so you can remotely access the command line on the Freescale FRDM-K64F.</li>
<li>Required hardware: <a href="http://developer.mbed.org/platforms/IBMEthernetKit">mbed-enabled Freescale K64F</a>.</li>
<li><a href="https://aka.ms/howtocreateazureiothub">Setup your IoT hub</a></li>
<li><a href="https://aka.ms/manageiothub">Provision your device and get its credentials</a></li>
</ul>
<p><a class="anchor" id="Step-2-PrepareDevice"></a> </p>
<h1><a class="anchor" id="autotoc_md127"></a>
Step 2: Prepare your Device</h1>
<ul>
<li>Connect the board to your network using an Ethernet cable. This step is required, as the sample depends on internet access.</li>
<li>Plug the device into your computer using a micro-USB cable. <b>Be sure to attach the cable to the USB port next to the reset button on the FRDM-K64F device</b>.</li>
<li>Follow the <a href="https://developer.mbed.org/handbook/SerialPC">instructions on the mbed handbook</a> to set up the serial connection with your device from your development machine. If you are on Windows, install the Windows serial port drivers located <a href="http://developer.mbed.org/handbook/Windows-serial-configuration#1-download-the-mbed-windows-serial-port">here</a>.</li>
</ul>
<p><a class="anchor" id="Step-3-Build"></a> </p>
<h1><a class="anchor" id="autotoc_md128"></a>
Step 3: Build and Run the sample</h1>
<h2><a class="anchor" id="autotoc_md129"></a>
Create mbed project and import the sample code</h2>
<ul>
<li>In your web browser, go to the mbed.org <a href="https://developer.mbed.org/">developer site</a>. If you haven't signed up, you will see an option to create a new account (it's free). Otherwise, log in with your account credentials. Then click on <b>Compiler</b> in the upper right-hand corner of the page. This should bring you to the Workspace Management interface.</li>
<li>Make sure the hardware platform you're using appears in the upper right-hand corner of the window, or click the icon in the right-hand corner to select your hardware platform.</li>
<li><p class="startli">Click <b>Import</b> on the main menu. Then click the <b>Click here</b> to import from URL link next to the mbed globe logo.</p>
<p class="startli"><img src="./media/mbed1.png" alt="" class="inline"/></p>
</li>
<li><p class="startli">In the popup window, enter the link for the sample code of your choice (we have a sample for each of the protocols supported):</p><ul>
<li><a href="https://developer.mbed.org/users/AzureIoTClient/code/iothub_client_sample_amqp/">https://developer.mbed.org/users/AzureIoTClient/code/iothub_client_sample_amqp/</a> (we'll use this one for this guide, but steps are the same for others).</li>
<li><a href="https://developer.mbed.org/users/AzureIoTClient/code/iothub_client_sample_mqtt/">https://developer.mbed.org/users/AzureIoTClient/code/iothub_client_sample_mqtt/</a></li>
<li><a href="https://developer.mbed.org/users/AzureIoTClient/code/iothub_client_sample_http/">https://developer.mbed.org/users/AzureIoTClient/code/iothub_client_sample_http/</a></li>
</ul>
<p class="startli"><img src="./media/mbed2.png" alt="" class="inline"/></p>
</li>
<li><p class="startli">You can see in the mbed compiler that importing this project imported various libraries. Some are provided and maintained by the Azure IoT team (<a href="https://developer.mbed.org/users/AzureIoTClient/code/azureiot_common/">azureiot_common</a>, <a href="https://developer.mbed.org/users/AzureIoTClient/code/iothub_client/">iothub_client</a>, <a href="https://developer.mbed.org/users/AzureIoTClient/code/iothub_amqp_transport/">iothub_amqp_transport</a>, <a href="https://developer.mbed.org/users/AzureIoTClient/code/iothub_http_transport/">iothub_http_transport</a>, <a href="https://developer.mbed.org/users/AzureIoTClient/code/azure_uamqp_c/">azure-uamqp-c</a>), while others are third party libraries available in the mbed libraries catalog.</p>
<p class="startli"><img src="./media/mbed3.png" alt="" class="inline"/></p>
</li>
<li><p class="startli">Open iothub_client_sample_amqp/iothub_client_sample_amqp.c, and replace "[device connection string]" with the device connection string you noted <a href="#Step-1-Prerequisites">earlier</a>:</p>
<p class="startli"><img src="./media/mbed4.png" alt="" class="inline"/></p>
</li>
<li>Save the changes.</li>
</ul>
<h2><a class="anchor" id="autotoc_md130"></a>
Build and run the program</h2>
<ul>
<li><p class="startli">Click <b>Compile</b> to build the program. You can safely ignore any warnings, but if the build generates errors, fix them before proceeding.</p>
<p class="startli"><img src="./media/mbed5.png" alt="" class="inline"/></p>
</li>
<li>If the build is successful, a .bin file with the name of your project is generated. Copy the .bin file to the device. Saving the .bin file to the device causes the current terminal session to the device to reset. When it reconnects, reset the terminal again manually, or start a new terminal. This enables the mbed device to reset and start executing the program.</li>
<li><p class="startli">Connect to the device using an SSH terminal program, such as PuTTY. You can determine which serial port your device uses by checking the Windows Device Manager:</p>
<p class="startli"><img src="./media/mbed6.png" alt="" class="inline"/></p>
</li>
<li><p class="startli">In PuTTY, click the <b>Serial</b> connection type. The device most likely connects at 115200, so enter that value in the <b>Speed</b> box. Then click <b>Open</b>: <b>NOTE</b> Try 9600 if unable to communicate with the board.</p>
<p class="startli"><img src="./media/mbed7.png" alt="" class="inline"/></p>
</li>
</ul>
<p>The program starts executing. You may have to reset the board (press CTRL+Break or press on the board's reset button) if the program does not start automatically when you connect.</p>
<h2><a class="anchor" id="autotoc_md131"></a>
Monitor device data and send messages</h2>
<ul>
<li>See <a href="https://aka.ms/manageiothub">Manage IoT Hub</a> to learn how to observe the messages IoT Hub receives from the application and how to send cloud-to-device messages to the application. </li>
</ul>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.0
</small></address>
</body>
</html>
